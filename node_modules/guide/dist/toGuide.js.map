{"version":3,"sources":["../src/toGuide.js"],"names":["toGuide","initializationVectorValue","namespace","type","id","length","cipher","createCipher","payload","JSON","stringify","encrypted","Buffer","concat","update","final","tag","getAuthTag","guide","toString"],"mappings":";;;;;;AAEA;;;;AACA;;AAGA;;;;AAOA;;;;;;;oBAbA;;AAkBA,IAAMA,4BAAuB,SAAvBA,OAAuB,CAACC,yBAAD,EAA4BC,SAA5B,EAAuCC,IAAvC,EAA6CC,EAA7C,EAAoD;AAC/E,MAAIH,0BAA0BI,MAA1B,KAAqC,GAAzC,EAA8C;AAC5C,UAAM,uBAAe,6DAAf,CAAN;AACD;;AAED,MAAMC,SAAS,iBAAOC,YAAP,CAAoB,aAApB,EAAmCN,yBAAnC,CAAf;;AAEA,MAAMO,UAAUC,KAAKC,SAAL,CAAe;AAC7BN,MAD6B;AAE7BF,aAF6B;AAG7BC;AAH6B,GAAf,CAAhB;;AAMA,MAAMQ,YAAYC,OAAOC,MAAP,CAAc,CAC9BP,OAAOQ,MAAP,CAAcN,OAAd,EAAuB,MAAvB,CAD8B,EAE9BF,OAAOS,KAAP,EAF8B,CAAd,CAAlB;;AAKA,MAAMC,MAAMV,OAAOW,UAAP,EAAZ;;AAEA,MAAMC,QAAQN,OAAOC,MAAP,CAAc,CAC1BG,GAD0B,EAE1BL,SAF0B,CAAd,CAAd;;AAKA,SAAO,uBAAaO,MAAMC,QAAN,CAAe,QAAf,CAAb,CAAP;AACD,CA1BD;;kBA4BenB,O","file":"toGuide.js","sourcesContent":["// @flow\n\nimport crypto from 'crypto';\nimport {\n  escape as base64Escape\n} from 'base64-url';\nimport {\n  GuideError\n} from './errors';\nimport type {\n  ToGuideType\n} from './types';\n\n/**\n * @param initializationVectorValue Initialization vector. Must be at least 128 characters long.\n * @param namespace A namespace of the GUID (e.g. company name or the application name).\n * @param type A resource type name (e.g. article).\n */\nconst toGuide: ToGuideType = (initializationVectorValue, namespace, type, id) => {\n  if (initializationVectorValue.length !== 128) {\n    throw new GuideError('Initialization vector must be at least 128 characters long.');\n  }\n\n  const cipher = crypto.createCipher('aes-256-gcm', initializationVectorValue);\n\n  const payload = JSON.stringify({\n    id,\n    namespace,\n    type\n  });\n\n  const encrypted = Buffer.concat([\n    cipher.update(payload, 'utf8'),\n    cipher.final()\n  ]);\n\n  const tag = cipher.getAuthTag();\n\n  const guide = Buffer.concat([\n    tag,\n    encrypted\n  ]);\n\n  return base64Escape(guide.toString('base64'));\n};\n\nexport default toGuide;\n"]}